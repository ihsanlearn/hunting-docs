# Lab: Reflected XSS protected by CSP, with CSP bypass | Web Security Academy

EXPERT

This lab uses CSP and contains a reflected XSS vulnerability.

To solve the lab, perform a cross-site scripting attack that bypasses the CSP and calls the `alert` function.

Please note that the intended solution to this lab is only possible in Chrome.

Access the lab: https://portswigger.net/academy/labs/launch/81ee8accf0de217426c4c6c3b260eece41c471f80271541fc170ba4a66492339?referrer=%2fweb-security%2fcross-site-scripting%2fcontent-security-policy%2flab-csp-bypass

{% stepper %}
{% step %}
### Step

Enter the following into the search box:

`<img src=1 onerror=alert(1)>`

Observe that the payload is reflected, but the CSP prevents the script from executing.
{% endstep %}

{% step %}
### Step

In Burp Proxy, observe that the response contains a `Content-Security-Policy` header, and the `report-uri` directive contains a parameter called `token`. Because you can control the `token` parameter, you can inject your own CSP directives into the policy.
{% endstep %}

{% step %}
### Step

Visit the following URL, replacing `YOUR-LAB-ID` with your lab ID:

`https://YOUR-LAB-ID.web-security-academy.net/?search=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&token=;script-src-elem%20%27unsafe-inline%27`

The injection uses the `script-src-elem` directive in CSP. This directive allows you to target just `script` elements. Using this directive, you can overwrite existing `script-src` rules enabling you to inject `unsafe-inline`, which allows you to use inline scripts.
{% endstep %}
{% endstepper %}

<details>

<summary>Community solutions</summary>

*   Michael Sommer — Reflected XSS protected by CSP, with CSP bypass (Video solution, Audio)\
    https://www.youtube.com/watch?v=hx9DjDxuYOE

    Photo image link: https://www.youtube.com/channel/UCfchiSwWibUyS2USW9NQSWw?embeds\_referring\_euri=https%3A%2F%2Fportswigger.net%2F\&embeds\_referring\_origin=https%3A%2F%2Fportswigger.net

</details>

Find XSS vulnerabilities using Burp Suite — Try for free: https://portswigger.net/burp
